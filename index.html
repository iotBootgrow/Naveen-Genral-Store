<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Naveen General Store - WhatsApp Demo</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #e5ddd5;
    margin: 0;
    padding: 0;
}
h1 {
    text-align: center;
    background: #075e54;
    color: white;
    padding: 10px;
    margin: 0;
}
.container {
    display: flex;
    gap: 10px;
    padding: 10px;
}
.chat, .merchant {
    background: #f0f0f0;
    border-radius: 8px;
    padding: 10px;
    width: 50%;
    height: 85vh;
    display: flex;
    flex-direction: column;
}
.chat-header {
    background: #128c7e;
    color: white;
    padding: 10px;
    border-radius: 8px 8px 0 0;
}
.messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    background: #ece5dd;
}
.msg {
    max-width: 75%;
    padding: 8px 10px;
    border-radius: 8px;
    margin: 5px 0;
    font-size: 14px;
}
.bot {
    background: white;
    align-self: flex-start;
}
.user {
    background: #dcf8c6;
    align-self: flex-end;
}
.input-area {
    display: flex;
    gap: 5px;
}
input {
    padding: 6px;
    font-size: 14px;
    width: 100%;
}
button {
    background: #128c7e;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
}
.merchant h2 {
    margin-top: 0;
    color: #075e54;
}
.card {
    background: white;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 10px;
}
.status {
    font-weight: bold;
    margin-top: 10px;
    color: green;
}
</style>
</head>
<body>

<h1>üì¶ Naveen General Store ‚Äì WhatsApp Ordering Demo</h1>

<div class="container">

    <div class="chat">
        <div class="chat-header">Naveen General Store</div>
        <div class="messages" id="chatBox"></div>
        <div class="input-area">
            <input type="text" id="userInput" placeholder="Type here..." />
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>

    <div class="merchant">
        <h2>üè™ Merchant Dashboard</h2>
        <div id="merchantPanel">No orders yet.</div>
        <div id="assignPanel" style="display:none;">
            <h3>üöö Assign Rider</h3>
            <input type="text" id="riderName" placeholder="Rider Name"><br><br>
            <input type="text" id="riderPhone" placeholder="Rider Phone"><br><br>
            <button onclick="dispatchOrder()">Dispatch Order</button>
        </div>
        <div class="status" id="orderStatus"></div>
    </div>

</div>

<script>
let step = 0;
let order = {};
let totalMRP = 0;
let totalPrice = 0;

const products = {
    "atta": { name: "Atta 5kg", mrp: 350, price: 300 },
    "dal": { name: "Toor Dal 1kg", mrp: 140, price: 110 },
    "spices": { name: "Turmeric 200g", mrp: 60, price: 45 },
    "tea": { name: "Tata Tea 250g", mrp: 140, price: 120 },
    "cosmetics": { name: "Nivea Cream", mrp: 180, price: 150 }
};

const chatBox = document.getElementById("chatBox");

function addMessage(text, type) {
    const msg = document.createElement("div");
    msg.className = `msg ${type}`;
    msg.innerText = text;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
}

addMessage("Welcome to Naveen General Store üëã\nType: ORDER to start", "bot");

function sendMessage() {
    const input = document.getElementById("userInput");
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, "user");
    input.value = "";
    handleBot(text.toLowerCase());
}

function handleBot(text) {
    if (step === 0 && text === "order") {
        addMessage("Choose category:\n1 Atta\n2 Dal\n3 Spices\n4 Tea/Coffee\n5 Cosmetics", "bot");
        step = 1;
        return;
    }
    if (step === 1) {
        if (text === "1") selectProduct("atta");
        else if (text === "2") selectProduct("dal");
        else if (text === "3") selectProduct("spices");
        else if (text === "4") selectProduct("tea");
        else if (text === "5") selectProduct("cosmetics");
        else addMessage("Choose 1‚Äì5", "bot");
        return;
    }
    if (step === 2) {
        const qty = parseInt(text);
        if (!qty) { addMessage("Enter valid quantity", "bot"); return; }
        const item = order.current;
        order[item.key] = qty;
        totalMRP += item.mrp * qty;
        totalPrice += item.price * qty;
        addMessage(`Added ${item.name} x ${qty}`, "bot");
        addMessage("Type YES to confirm or ORDER to add more", "bot");
        step = 3;
        return;
    }
    if (step === 3) {
        if (text === "order") {
            addMessage("Choose category again (1‚Äì5)", "bot");
            step = 1;
            return;
        }
        if (text === "yes") {
            addMessage("Enter delivery address:", "bot");
            step = 4;
            return;
        }
    }
    if (step === 4) {
        order.address = text;
        addMessage(`Order placed!\nTotal: ‚Çπ${totalPrice}\nSaved: ‚Çπ${totalMRP-totalPrice}`, "bot");
        showMerchantOrder();
    }
}

function selectProduct(key) {
    const p = products[key];
    order.current = { key, ...p };
    addMessage(`${p.name}\nMRP ‚Çπ${p.mrp} ‚Üí ‚Çπ${p.price}\nEnter quantity:`, "bot");
    step = 2;
}

function showMerchantOrder() {
    let items = "";
    for (let key in order) {
        if (products[key]) items += `${products[key].name} x ${order[key]}<br>`;
    }
    document.getElementById("merchantPanel").innerHTML = `
        <div class="card">
            <strong>Items:</strong><br>${items}
            <p>Total: ‚Çπ${totalPrice}</p>
            <p>Address: ${order.address}</p>
            <button onclick="confirmOrder()">Confirm</button>
        </div>`;
}

function confirmOrder() {
    document.getElementById("assignPanel").style.display = "block";
}

function dispatchOrder() {
    const rider = document.getElementById("riderName").value;
    const phone = document.getElementById("riderPhone").value;
    document.getElementById("orderStatus").innerHTML = `Out for delivery by ${rider} (${phone})`;
    addMessage(`üöö Out for delivery\nRider: ${rider}\nPhone: ${phone}`, "bot");
}
</script>

</body>
</html>
